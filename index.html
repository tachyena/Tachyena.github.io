<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google-site-verification" content="google7217b3ac0ba5fa61.html">
    <title>智泊云 - 智能停车场优化系统</title>
    <!-- 高德地图JS API，使用您的密钥 -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=2a3543776c048b0253b10252fa8c3356"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        #map {
            height: 600px;
            width: 100%;
            margin-top: 20px;
            border-radius: 8px;
            background: #ddd; /* 若地图加载失败，显示灰色背景 */
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
            align-items: center;
        }
        select, input[type="text"], .button {
            padding: 10px;
            width: 200px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .button {
            background: #3498db;
            color: #fff;
            text-align: center;
            cursor: pointer;
            text-decoration: none;
        }
        .button:hover {
            background: #2980b9;
        }
        .update-time {
            text-align: center;
            font-size: 14px;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>智泊云 - 智能停车场优化系统</h1>
        <div class="controls">
            <select id="district-select">
                <option value="中国">全国</option>
            </select>
            <input type="text" id="city-search" placeholder="输入城市名称搜索">
            <select id="parking-select">
                <option value="">选择停车场</option>
            </select>
            <a href="#" class="button" id="navigate-btn">导航至选中车位</a>
        </div>
        <div id="map"></div>
        <p class="update-time">最后更新: <span id="last-update">加载中...</span></p>
    </div>

    <script>
        // 模拟停车场数据（武汉集中）
        const parkingLots = [
            { id: 1, name: "北京停车场A", lnglat: [116.397428, 39.90923], spaces: 50, occupied: 30 },
            { id: 2, name: "上海停车场B", lnglat: [121.473701, 31.230416], spaces: 40, occupied: 25 },
            { id: 3, name: "广州停车场C", lnglat: [113.264434, 23.129162], spaces: 30, occupied: 10 },
            { id: 4, name: "武汉停车场D", lnglat: [114.305392, 30.593099], spaces: 60, occupied: 40 },
            { id: 5, name: "武汉停车场E", lnglat: [114.300000, 30.595000], spaces: 50, occupied: 20 },
            { id: 6, name: "武汉停车场F", lnglat: [114.310000, 30.600000], spaces: 45, occupied: 20 }
        ];

        let map = null;
        let userPosition = null;
        let selectedParking = null;

        // 等待DOM加载完成再初始化地图
        window.onload = function() {
            try {
                map = new AMap.Map('map', {
                    zoom: 4,
                    center: [104.195397, 35.86166], // 中国地理中心
                    resizeEnable: true,
                    mapStyle: 'amap://styles/normal',
                    features: ['bg', 'road', 'building', 'point'],
                    viewMode: '2D',
                    showLabel: true
                });

                // 添加地图控件
                map.plugin(['AMap.ToolBar', 'AMap.Scale'], function() {
                    map.addControl(new AMap.ToolBar());
                    map.addControl(new AMap.Scale());
                });

                // 添加停车场标记和下拉菜单
                const parkingSelect = document.getElementById('parking-select');
                parkingLots.forEach(lot => {
                    let marker = new AMap.Marker({
                        position: lot.lnglat,
                        title: lot.name,
                        map: map,
                        label: { content: `${lot.name} (${lot.spaces - lot.occupied}空位)`, offset: new AMap.Pixel(10, -10) }
                    });
                    marker.on('click', () => {
                        selectedParking = lot;
                        map.setCenter(lot.lnglat);
                        map.setZoom(15);
                    });
                    let option = document.createElement('option');
                    option.value = lot.id;
                    option.textContent = `${lot.name} (${lot.spaces - lot.occupied}空位)`;
                    parkingSelect.appendChild(option);
                });

                // 行政区划选择（简化版）
                const districtSelect = document.getElementById('district-select');
                const provinces = {
                    "42": { name: "湖北省", center: [114.305392, 30.593099], zoom: 8 },
                    "11": { name: "北京市", center: [116.397428, 39.90923], zoom: 10 },
                    "31": { name: "上海市", center: [121.473701, 31.230416], zoom: 10 }
                };
                Object.keys(provinces).forEach(adcode => {
                    let option = document.createElement('option');
                    option.value = adcode;
                    option.textContent = provinces[adcode].name;
                    districtSelect.appendChild(option);
                });

                districtSelect.addEventListener('change', (e) => {
                    let adcode = e.target.value;
                    if (adcode === '中国') {
                        map.setZoomAndCenter(4, [104.195397, 35.86166]);
                    } else if (provinces[adcode]) {
                        map.setZoomAndCenter(provinces[adcode].zoom, provinces[adcode].center);
                    }
                });

                // 城市搜索
                AMap.plugin('AMap.AutoComplete', function() {
                    let autoComplete = new AMap.AutoComplete({ city: '全国' });
                    document.getElementById('city-search').addEventListener('input', (e) => {
                        autoComplete.search(e.target.value, function(status, result) {
                            if (status === 'complete' && result.tips && result.tips.length > 0) {
                                let tip = result.tips[0];
                                map.setCenter(tip.location);
                                map.setZoom(12);
                            }
                        });
                    });
                });

                // 定位
                AMap.plugin('AMap.Geolocation', function() {
                    let geolocation = new AMap.Geolocation({
                        enableHighAccuracy: true,
                        timeout: 10000,
                        buttonOffset: new AMap.Pixel(10, 20),
                        zoomToAccuracy: true
                    });
                    map.addControl(geolocation);
                    geolocation.getCurrentPosition(function(status, result) {
                        if (status === 'complete') {
                            userPosition = result.position;
                            let marker = new AMap.Marker({
                                position: userPosition,
                                map: map,
                                icon: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                                title: '您的位置'
                            });
                            map.setCenter(userPosition);
                            map.setZoom(15);
                        }
                    });
                });

                // 导航
                document.getElementById('navigate-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    if (!userPosition || !selectedParking) {
                        alert('请先定位并选择停车场！');
                        return;
                    }
                    AMap.plugin('AMap.Driving', function() {
                        let driving = new AMap.Driving({ map: map });
                        driving.search(userPosition, selectedParking.lnglat, function(status, result) {
                            if (status !== 'complete') {
                                alert('导航失败: ' + result);
                            }
                        });
                    });
                });

                // 更新时间
                document.getElementById('last-update').textContent = new Date().toLocaleString('zh-CN');
            } catch (error) {
                console.error('地图加载失败:', error);
                document.getElementById('map').innerHTML = '地图加载失败，请检查网络或API密钥';
            }
        };
    </script>
</body>
</html>
